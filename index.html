<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DaVinciLens Lite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* æ¨¡æ“¬æˆªåœ–ä¸­çš„æš–è‰²èª¿é¢¨æ ¼ */
        body { background-color: #FFF9E7; color: #5D4037; }
        .card { background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .btn-orange { background-color: #E67E22; color: white; border-radius: 50px; }
    </style>
</head>
<body class="p-6">
    <header class="mb-8 text-center">
        <h1 class="text-2xl font-bold">DaVinciLens é”æ–‡è¥¿é€é¡</h1>
        <p class="text-sm opacity-70">è®“ AI æˆç‚ºä½ çš„å°ˆå±¬æ€ç¶­å°å¸«</p>
    </header>

    <div class="card p-6 mb-6">
        <input type="file" id="cameraInput" accept="image/*" capture="environment" class="hidden">
        <button onclick="document.getElementById('cameraInput').click()" class="btn-orange w-full py-4 text-lg font-bold">
            ğŸ“¸ æ‹ä¸‹æ‰‹å¯«éˆæ„Ÿ
        </button>
    </div>

    <div id="aiSection" class="hidden">
        <div class="flex items-center mb-4">
            <span class="text-2xl mr-2">ğŸ§ </span>
            <h2 class="font-bold">å°å¸«æ­£åœ¨é–±è®€ä½ çš„ç­†è¨˜...</h2>
        </div>
        <div id="aiResponse" class="card p-6 text-sm leading-relaxed whitespace-pre-wrap">
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // å®‰å…¨æª¢æŸ¥é‚è¼¯ï¼šå¾æœ¬åœ°å–å¾—æˆ–è©¢å• Key
        let API_KEY = localStorage.getItem('my_gemini_key');
        if (!API_KEY) {
            API_KEY = prompt("è«‹è¼¸å…¥æ‚¨çš„ Gemini API Keyï¼š");
            if (API_KEY) {
                localStorage.setItem('my_gemini_key', API_KEY);
            }
        }

        const genAI = new GoogleGenerativeAI(API_KEY);

        document.getElementById('cameraInput').onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            document.getElementById('aiSection').classList.remove('hidden');
            document.getElementById('aiResponse').innerText = "å°å¸«æ€è€ƒä¸­...";

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onloadend = async () => {
                const base64Data = reader.result.split(',')[1];
                
                try {
                    // ä½¿ç”¨ Gemini 3 Flash æ¨¡å‹
                    const model = genAI.getGenerativeModel({ model: "gemini-3-flash" });
                    const prompt = `
                        ä½ æ˜¯ä¸€ä½å°ˆå±¬æ€ç¶­å°å¸«ã€‚
                        1. è¾¨è­˜é€™å¼µåœ–ç‰‡è£¡çš„æ‰‹å¯«ç­†è¨˜å…§å®¹ã€‚
                        2. ä»¥ã€æ€ç¶­å°å¸«ã€çš„èªæ°£ï¼Œåˆ†æé€™ä»½ç­†è¨˜çš„ä¸€å€‹æ ¸å¿ƒæ´å¯Ÿã€‚
                        3. æå‡ºä¸€å€‹å•Ÿç™¼æ€§çš„å•é¡Œã€‚
                    `;

                    const result = await model.generateContent([
                        prompt,
                        { inlineData: { data: base64Data, mimeType: "image/jpeg" } }
                    ]);

                    document.getElementById('aiResponse').innerText = result.response.text();
                } catch (err) {
                    document.getElementById('aiResponse').innerText = "æŠ±æ­‰ï¼Œå°å¸«æ–·ç·šäº†ï¼š" + err.message;
                    // å¦‚æœæ˜¯ API Key éŒ¯èª¤ï¼Œæ¸…é™¤å„²å­˜è®“ä½¿ç”¨è€…ä¸‹æ¬¡é‡æ–°è¼¸å…¥
                    if(err.message.includes("API key")) {
                        localStorage.removeItem('my_gemini_key');
                    }
                }
            };
        };
    </script>
</body>
</html>
